{
  "pluginAlias": "HueTransitions",
  "pluginType": "platform",
  "singular": true,
  "headerDisplay": "Homebridge plugin for Philips Hue scenes with configurable transition durations. For help and documentation please see the [GitHub repository](https://github.com/jay-d-tyler/homebridge-hue-transitions).",
  "footerDisplay": "**Tip:** After configuring your bridge details and saving, restart Homebridge and check the logs to see all available scenes with their IDs.",
  "schema": {
    "type": "object",
    "properties": {
      "name": {
        "title": "Name",
        "type": "string",
        "default": "Hue Transitions",
        "required": true,
        "description": "Name to display in the Homebridge log"
      },
      "bridgeIp": {
        "title": "Bridge IP Address",
        "type": "string",
        "format": "ipv4",
        "placeholder": "192.168.1.100",
        "description": "IP address of your Hue bridge (leave empty for auto-discovery)"
      },
      "apiKey": {
        "title": "API Key",
        "type": "string",
        "placeholder": "Your Hue API key / username",
        "description": "API key for your Hue bridge. See the README for instructions on how to create one."
      },
      "scenes": {
        "title": "Configured Scenes",
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "id": {
              "title": "Scene",
              "type": "string",
              "required": true,
              "description": "Select a scene from your Hue bridge"
            },
            "name": {
              "title": "Display Name",
              "type": "string",
              "required": true,
              "description": "Name shown in HomeKit (auto-filled from scene selection)"
            },
            "transitionDuration": {
              "title": "Transition (minutes)",
              "type": "integer",
              "default": 30,
              "minimum": 1,
              "maximum": 60,
              "required": true,
              "description": "Duration for gradual transition (1-60 minutes)"
            }
          }
        }
      },
      "pollingInterval": {
        "title": "Polling Interval (milliseconds)",
        "type": "integer",
        "default": 60000,
        "minimum": 60000,
        "maximum": 300000,
        "description": "How often to check scene status (60000-300000ms, default 60000ms = 1 minute)"
      },
      "debug": {
        "title": "Enable Debug Logging",
        "type": "boolean",
        "default": false,
        "description": "Enable detailed debug logging for troubleshooting"
      }
    }
  },
  "layout": [
    {
      "type": "flex",
      "flex-flow": "row wrap",
      "items": [
        {
          "type": "flex",
          "flex-flow": "column",
          "items": ["name"],
          "flex": "1 1 50%"
        }
      ]
    },
    {
      "type": "fieldset",
      "title": "Hue Bridge Configuration",
      "expandable": false,
      "items": [
        {
          "type": "help",
          "helpvalue": "<p class='help-block'><strong>Quick Setup:</strong></p><ol><li>The plugin will auto-discover your Hue bridge</li><li>Check the logs for instructions to create an API key</li><li>Press the link button on your Hue bridge</li><li>Run the command from the logs to get your API key</li><li>Enter the API key above and click Save</li></ol>"
        },
        "bridgeIp",
        "apiKey"
      ]
    },
    {
      "type": "fieldset",
      "title": "Scene Configuration",
      "expandable": false,
      "items": [
        {
          "type": "help",
          "helpvalue": "<div id='scene-helper'><p class='help-block'><strong>Add Your Scenes:</strong></p><button type='button' class='btn btn-sm btn-primary' id='fetch-scenes-btn' style='margin-bottom: 15px;'>Load Available Scenes</button><div id='scene-loader' style='display:none; margin: 15px 0;'><div class='spinner-border spinner-border-sm'></div> Loading scenes from bridge...</div><div id='scene-error' class='alert alert-danger' style='display:none; margin-top: 10px;'></div><div id='available-scenes' style='display:none; margin-top: 15px;'><p class='help-block'><strong>Click a scene to add it:</strong></p><div id='scenes-list' style='max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px;'></div></div></div><p class='help-block' style='margin-top: 15px;'>Each scene will appear in HomeKit as a switch. When activated, lights will gradually transition to the scene over your chosen duration.</p><script>(function(){const btn=document.getElementById('fetch-scenes-btn');const loader=document.getElementById('scene-loader');const error=document.getElementById('scene-error');const available=document.getElementById('available-scenes');const list=document.getElementById('scenes-list');if(!btn)return;btn.onclick=async function(){btn.disabled=true;loader.style.display='block';error.style.display='none';available.style.display='none';try{const response=await fetch('/api/config-editor/platform/HueTransitions');if(!response.ok)throw new Error('Failed to fetch config');const configs=await response.json();if(!configs||configs.length===0){throw new Error('Plugin not configured. Please add bridge IP and API key above first.');}const config=configs[0];if(!config.bridgeIp||!config.apiKey){throw new Error('Please configure bridge IP and API key above first.');}const logsResp=await fetch('/api/logs/download');const logs=await logsResp.text();const sceneMatches=logs.match(/- \"([^\"]+)\" \\(ID: ([^)]+)\\)/g);if(!sceneMatches||sceneMatches.length===0){throw new Error('No scenes found in logs. Please restart Homebridge first.');}const scenes=sceneMatches.map(m=>{const match=m.match(/- \"([^\"]+)\" \\(ID: ([^)]+)\\)/);return{name:match[1],id:match[2]};});loader.style.display='none';available.style.display='block';list.innerHTML='';scenes.forEach(scene=>{const div=document.createElement('div');div.style.cssText='padding:8px;margin:5px 0;border:1px solid #ccc;border-radius:4px;cursor:pointer;background:#f8f9fa;';div.innerHTML=`<strong>${scene.name}</strong><br><small style='color:#666;font-family:monospace;'>${scene.id}</small>`;div.onclick=function(){const formData=homebridge.formData;if(!formData.scenes)formData.scenes=[];formData.scenes.push({id:scene.id,name:scene.name,transitionDuration:30});homebridge.updateFormData(formData);homebridge.toast.success('Added '+scene.name,'Success');};div.onmouseover=function(){this.style.background='#e9ecef';};div.onmouseout=function(){this.style.background='#f8f9fa';};list.appendChild(div);});}catch(err){loader.style.display='none';error.style.display='block';error.textContent=err.message;}finally{btn.disabled=false;}}})();</script>"
        },
        {
          "key": "scenes",
          "type": "array",
          "title": "Scenes with Transition",
          "items": [
            {
              "type": "div",
              "displayFlex": true,
              "flex-direction": "row",
              "items": [
                {
                  "key": "scenes[].id",
                  "flex": "1 1 40%",
                  "placeholder": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
                },
                {
                  "key": "scenes[].name",
                  "flex": "1 1 30%",
                  "placeholder": "Scene name"
                },
                {
                  "key": "scenes[].transitionDuration",
                  "flex": "1 1 30%",
                  "placeholder": "30"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "fieldset",
      "title": "Advanced Settings",
      "expandable": true,
      "expanded": false,
      "items": [
        "pollingInterval",
        "debug"
      ]
    }
  ]
}
